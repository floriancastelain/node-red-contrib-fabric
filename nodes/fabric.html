<!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<script type="text/x-red" data-template-name="fabric-out">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>

    <div class="form-row">
        <label for="node-input-connection"><i class="fa"></i>Connection</label>
        <input type="select" id="node-input-connection" placeholder="Connection"/>
    </div>

     <div class="form-row">
        <label for="node-input-channelName"><i class="fa"></i>Channel Name</label>
        <input type="text" id="node-input-channelName" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-contractName"><i class="fa"></i>Contract Name</label>
        <input type="text" id="node-input-contractName" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-actionType"><i class="fa"></i>Action Type</label>
        <select id="node-input-actionType">
            <option value="submit">Submit Transaction</option>
            <option value="evaluate">Evaluate Transaction</option>
        </select>
    </div>
</script>
<script type="text/x-red" data-template-name="fabric-mid">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>

    <div class="form-row">
        <label for="node-input-connection"><i class="fa"></i>Connection</label>
        <input type="select" id="node-input-connection" placeholder="Connection"/>
    </div>

     <div class="form-row">
        <label for="node-input-channelName"><i class="fa"></i>Channel Name</label>
        <input type="text" id="node-input-channelName" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-contractName"><i class="fa"></i>Contract Name</label>
        <input type="text" id="node-input-contractName" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-actionType"><i class="fa"></i>Action Type</label>
        <select id="node-input-actionTypeForm">
            <option value="submit">Submit Transaction</option>
            <option value="evaluate">Evaluate Transaction</option>
            <option value="query">Query Worldstate</option>
            <option value="event">Listen Event</option>
        </select>
    </div>

</script>
<script type="text/x-red" data-template-name="fabric-in">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-connection"><i class="fa"></i>Connection</label>
        <input type="select" id="node-input-connection" placeholder="Connection"/>
    </div>
     <div class="form-row">
        <label for="node-input-channelName"><i class="fa"></i>Channel Name</label>
        <input type="text" id="node-input-channelName" placeholder=""/>
    </div>
    <div class="form-row">
        <label for="node-input-contractName"><i class="fa"></i>Contract Name</label>
        <input type="text" id="node-input-contractName" placeholder=""/>
    </div>
    <div class="form-row">
        <label for="node-input-eventName"><i class="fa"></i>Event Name</label>
        <input type="text" id="node-input-eventName" placeholder=".*"/>
    </div>
</script>
<script type="text/x-red" data-template-name="fabric-event-list">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-connection"><i class="fa"></i>Connection</label>
        <input type="select" id="node-input-connection" placeholder="Connection"/>
    </div>

     <div class="form-row">
        <label for="node-input-channelName"><i class="fa"></i>Channel Name</label>
        <input type="text" id="node-input-channelName" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-contractName"><i class="fa"></i>Contract Name</label>
        <input type="text" id="node-input-contractName" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-eventName"><i class="fa"></i>Event Name</label>
        <input type="text" id="node-input-eventName" placeholder=".*"/>
    </div>
    <div class="form-row">
        <label for="node-input-startBlock"><i class="fa"></i>Start Block</label>
        <input type="text" id="node-input-startBlock" placeholder=".*"/>
    </div>
    <div class="form-row">
        <label for="node-input-endBlock"><i class="fa"></i>End Block</label>
        <input type="text" id="node-input-endBlock" placeholder=".*"/>
    </div>
    <div class="form-row">
        <label for="node-input-orgName"><i class="fa"></i>Org name</label>
        <input type="text" id="node-input-orgName" placeholder=".*"/>
    </div>
    <div class="form-row">
        <label for="node-input-peerName"><i class="fa"></i>Peer name</label>
        <input type="text" id="node-input-peerName" placeholder=".*"/>
    </div>
    <div class="form-row">
        <label for="node-input-walletLocation"><i class="fa"></i>Wallet location</label>
        <input type="text" id="node-input-walletLocation" placeholder=".*"/>
    </div>
    <div class="form-row">
        <label for="node-input-timeout"><i class="fa"></i>timeout</label>
        <input type="text" id="node-input-timeout" placeholder=".*"/>
    </div>
</script>
<script type="text/x-red" data-template-name="fabric-query">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>

    <div class="form-row">
        <label for="node-input-connection"><i class="fa"></i>Connection</label>
        <input type="select" id="node-input-connection" placeholder="Connection"/>
    </div>

     <div class="form-row">
        <label for="node-input-channelName"><i class="fa"></i>Channel Name</label>
        <input type="text" id="node-input-channelName" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-request"><i class="fa"></i>Request</label>
        <input type="text" id="node-input-request" placeholder=""/>
    </div>

    <div class="form-row">
        <label for="node-input-contractName"><i class="fa"></i>Chaincode name</label>
        <input type="text" id="node-input-contractName" placeholder=""/>
    </div>
</script>
<script type="text/x-red" data-help-name="fabric-out">
  <p>Hyperledger Fabric output node. Submit or evaluate transactions</p>
  <p>The name of the transaction should be set like <code>msg.payload.transactionName</code></p>
  <p>The arguments for the transaction should be set like <code>msg.payload.args</code>. The arguments should be an array of strings</p>
  <p>For example <code>{"transactionName: "myTransaction", "args": ["arg1", "arg2"]}</code></p>
</script>
<script type="text/javascript">
    RED.nodes.registerType('fabric-out', {
        category : 'Hyperledger',
        color : '#E6E0F8',
        paletteLabel : 'Hyperledger Fabric - Out',
        defaults : {
            name : {value : ''},
            connection : {value : '', type : 'fabric-config'},
            channelName : {value : '', required : true},
            contractName : {value : '', required : true},
            //TODO: Fix relation between actionType and actionTypeForm
            actionType : {value : 'submit'}
        },
        inputs : 1,
        outputs : 0,
        icon : 'icon.png',
        align : 'right',
        label : function () {
            return this.name || 'Hyperledger Fabric - Out';
        }
    });
</script>
<script type="text/x-red" data-help-name="fabric-mid">
<p>Hyperledger Fabric mid node. Submit or evaluate transactions and query world state</p>


  <ul>
    <li>Submit/evaluate
      <ul>
        <li>the arguments for the transaction should be set like <code>msg.payload.transactionArgs</code>.</li>
        <li>The arguments should be an array of strings</li>
        <li>The name of the transaction should be set like <code>msg.payload.transactionName</code></li>
        <li>The type of transaction (<code>submit</code> or <code>evaluate</code>) should be set like <code>msg.payload.actionType</code>. The value set in the node will be overwritten by the value in <code>msg.payload</code></li>
        <li>Example: <code>{"transactionArgs": ["Arg1","Arg2","Arg3",],"transactionName": "myTransactionName","actionType": "submit"}</code> </li>
    </ul>
    </li>
    <li>Query
        <ul>
          <li>the arguments for the transaction should be set like <code>msg.payload.queryArgs</code>.</li>
          <li>The arguments should be an array of strings</li>
          <li>The type of transaction (<code>query</code>) should be set like <code>msg.payload.actionType</code>. The value set in the node will be overwritten by the value in <code>msg.payload</code></li>
          <li>The name of the function to use in the chaincode should be set like <code>msg.payload.queryFcn</code> </li>
          <li>Example: <code>{"queryArgs": ["myAssetKey"],"queryFcn": "query","actionType": "query"}</code> </li>
        </ul>
      </li>
  </ul>
  <p>Data returned from a transaction will be in <code>msg.payload</></p>
  <p>The <code>payload</code> will be a buffer and you will need to deserialize the data downstream</p>
  <p>For example <code>msg.payload.toString()</code>

</script>
<script type="text/javascript">
    RED.nodes.registerType('fabric-mid', {
        category : 'Hyperledger',
        color : '#E6E0F8',
        paletteLabel : 'Hyperledger Fabric - Mid',
        defaults : {
            name : {value : ''},
            connection : {value : '', type : 'fabric-config'},
            channelName : {value : '', required : false},
            contractName : {value : '', required : false},
            actionTypeForm : {value : 'submit'}
        },
        inputs : 1,
        outputs : 1,
        icon : 'icon.png',
        label : function () {
            return this.name || 'Hyperledger Fabric - Mid';
        },
    });
</script>
<script type="text/x-red" data-help-name="fabric-in">
    <p>Hyperledger Fabric input node. Subscribe to events emitted by a blockchain</p>.
    <p>Will create a message with the structure <code>{"eventName" : "myEvent", "payload": "myPayload"}</code></p>
    <p>The <code>payload</code> will be a buffer and you will need to deserialize the data downstream</p>
    <p>For example <code>msg.payload.toString()</code>
  </script>
<script type="text/javascript">
      RED.nodes.registerType('fabric-in', {
          category: 'Hyperledger',
          color: "#E6E0F8",
          paletteLabel: "Hyperledger Fabric",
          defaults: {
              name: {value: ""},
              connection : {value : '', type : 'fabric-config'},
              channelName : {value : '', required : true},
              contractName : {value : '', required : true},
              eventName : {value : '.*', required : false},
          },
          inputs : 0,
          outputs : 1,
          icon : "icon.png",
          align : "left",
          label : function () {
              return this.name || "Hyperledger Fabric";
          }
      });
</script>
<script type="text/x-red" data-help-name="fabric-event-list">
    <p>Hyperledger Fabric input node. Subscribe to events emitted by a blockchain</p>.
    <p>Will create a message with the structure <code>{"eventName" : "myEvent", "payload": "myPayload"}</code></p>
    <p>The <code>payload</code> will be a buffer and you will need to deserialize the data downstream</p>
    <p>For example <code>msg.payload.toString()</code>
    <p>The start block and end block are not required.</p>
  </script>
<script type="text/javascript">
      RED.nodes.registerType('fabric-event-list', {
          category: 'Hyperledger',
          color: "#E6E0F8",
          paletteLabel: "Hyperledger Fabric - Event list",
          defaults: {
              name: {value: ""},
              connection : {value : '', type : 'fabric-config', required: true},
              channelName : {value : '', required : false},
              contractName : {value : '', required : false},
              eventName : {value : '.*', required : false},
              startBlock: {value: '', type: 'num', required: false},
              endBlock: {value: '', type: 'num', required: false},
              orgName: {value: '', type: 'text', required: false},
              peerName: {value: '', type: 'text', required: false},
              walletLocation: {value:'', type:'text', required: true},
              timeout: {value: '', type: 'text', required: false}
              
          },
          inputs : 1,
          outputs : 1,
          icon : "icon.png",
          align : "left",
          label : function () {
              return this.name || "Hyperledger Fabric - Event list";
          }
      });
  </script>
<script type="text/x-red" data-help-name="fabric-query">
    <p>Hyperledger Fabric query node. Query the ledger world state</p>
    <p>This node returns a result, even if it is a chaincode error.</p>
    <p>Any input payload will overwrite the manual configuration</p>
    <p>The <code>request</code> parameter should be the following:</p>
    <p>Simple query: <code>{"chaincodeId":"chaincodeName","fcn":"query","args":["myarg"]}</code></p>
    <p>Rich query: <code> {"chaincodeId":"chaincodeName","fcn":"richQuery","args":["{ \"selector\": { \"field\": \"fieldValue\" } }"]}</code></p>
    <p>Notice that for the rich query, the arg has been escaped. You must do it before sending it to this node</p>
    <p>Remark: change the <code>fcn</code> property to suite the name of the query function you have in your chaincode</p>
</script>
<script type="text/javascript">
        RED.nodes.registerType('fabric-query', {
            category : 'Hyperledger',
            color : '#E6E0F8',
            paletteLabel : 'Hyperledger Fabric - Query',
            defaults : {
                name : {value : ''},
                connection : {value : '', type : 'fabric-config'},
                channelName : {value : '', required : false},
                request: {value: '', required: false},
                contractName: {value:'', required: false}
                },
            inputs : 1,
            outputs : 1,
            icon : 'icon.png',
            label : function () {
                return this.name || 'Hyperledger Fabric - Query';
            }
        });
</script>
